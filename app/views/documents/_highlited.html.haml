- plain_text = @document.plain_text
- rendered_until_idx = 0
- sorted_snippets(@document).each do |ne_start, ne_end, address_block|
  - if ne_start > 0
    = h(plain_text[rendered_until_idx..(ne_start - 1)]).gsub(/\n/, '<BR>').html_safe

  - rendered_until_idx = ne_end

  - link_text = h(plain_text[ne_start..ne_end-1]).gsub(/\n/, '<BR>').html_safe
  - @events = address_block.events
  - event_classes = @events.map { |e| "event-#{e.id}" }
  = link_to plain_text[ne_start..ne_end-1], [@document, address_block], { class: event_classes,
    id: "addressBlock-#{address_block.id}",
    title: "<a href=\"#addressBlock-#{address_block.id}\">Adresy <i class=\"fa fa-link\"></a>",
    data: { toggle: "popover", content: '<div class="inner"><i class="fa fa-spinner fa-spin"></i> Načítam...</div>', trigger: "focus", html: "true"} }
= h(plain_text[rendered_until_idx..-1]).gsub(/\n/, '<BR>').html_safe

<%= javascript_include_tag 'documents.js' %>
