.page-header
  %h1= @collection.model_name.human(count: 'other', default: @collection.model_name.human.pluralize)

  %h3
    %ul.breadcrumb.span8
      - lau = @parent
      - parents = []
      - while lau do parents << lau; lau = lau.parent end
      - parents.reverse!
      = link_to "Česká Republika", LocalAdministrationUnit
      - parents.each_with_index do |lau, idx|
        %span.divider /
        = link_to lau.title, { parent: lau.id }


%table.table.table-striped
  %thead
    %tr
      %th= @parent ? @parent.title : 'Kraje'
      %th= 'Počet dokumentů'
      %th= 'Počet dokumentů nižších správních celků'
      %th= 'Zpracováno za poslední týden'
  %tbody
    - week_ago = 7.days.ago.to_date
    - @sorted_collection.each do |resource|
      %tr
        %td= link_to_if((resource.ruian_locable_type != 'Momc' and resource.children.present?), resource.nazev, { parent: resource.id })
        %td= link_to resource.documents.count, polymorphic_path(Document, 'q[local_administration_unit_id_eq]' => resource.id)
        %td= Document.where('local_administration_unit_id IN (?)', resource.nested_ids).count
        %td= link_to resource.documents.where('created_at > ?', week_ago).count,
          polymorphic_path(Document,
            'q[local_administration_unit_id_eq]' => resource.id,
            'q[created_at_gt]' => week_ago)
